# –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö `/staff/finance` –∏ `/dashboard/staff/[id]/finance`

## –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞
- **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-01-27
- **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-02-15
- **–û—Ö–≤–∞—Ç**: –û–±–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –º–æ–¥—É–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

---

## üî¥ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—à–∏–±–∫–∞ "–ë–∏–∑–Ω–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω" –Ω–∞ `/dashboard/staff/[id]/finance` ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–û–ø–∏—Å–∞–Ω–∏–µ**: 
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–±–∏–Ω–µ—Ç—É" –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.

**–ü—Ä–∏—á–∏–Ω—ã**:
- –§—É–Ω–∫—Ü–∏—è `getBizContextForManagers()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ anon key, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–∞–º `user_roles` –∏ `businesses`
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–≥–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ service role key –¥–ª—è –æ–±—Ö–æ–¥–∞ RLS –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–∑–Ω–µ—Å—É
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –±–∏–∑–Ω–µ—Å–∞ - —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ä–æ–ª–∏ —Å `biz_id=null` (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏)
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–æ–ª–µ–π: —Å–Ω–∞—á–∞–ª–∞ —Ä–æ–ª–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º `biz_id`, –∑–∞—Ç–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `DashboardLayoutClient` —Å –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–≤ dev —Ä–µ–∂–∏–º–µ)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
- –§—É–Ω–∫—Ü–∏—è `getBizContextForManagers()` —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç service client –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- Service client –æ–±—Ö–æ–¥–∏—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –±–∏–∑–Ω–µ—Å–∞: super_admin ‚Üí user_roles (—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º biz_id) ‚Üí owner_id

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: ‚úÖ –†–ï–®–ï–ù–û

---

## üîÆ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
- ‚úÖ API endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –∏–∑ `api_request_metrics` (`/api/admin/metrics`, `/api/admin/metrics/stats`)
- ‚úÖ API endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–æ–≤ –∏–∑ `staff_finance_operation_logs` (`/api/admin/finance-logs`)
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ –∞–¥–º–∏–Ω–∫–µ (`/admin/monitoring`) —Å —Ç—Ä–µ–º—è –≤–∫–ª–∞–¥–∫–∞–º–∏:
  - **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ API –∑–∞–ø—Ä–æ—Å–∞–º (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –æ—à–∏–±–∫–∏, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, P95/P99)
  - **–ú–µ—Ç—Ä–∏–∫–∏ API**: –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É, –º–µ—Ç–æ–¥—É, —Å—Ç–∞—Ç—É—Å—É, —Ç–∏–ø—É –æ—à–∏–±–∫–∏
  - **–õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π**: –ª–æ–≥–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —É—Ä–æ–≤–Ω—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚è≥ –ê–ª–µ—Ä—Ç—ã –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º)

### –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ (>100 –∑–∞ —Å–º–µ–Ω—É)
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel/PDF –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö (–∑–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π)
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è `financeDomain` —Ñ—É–Ω–∫—Ü–∏–π
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
- –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö endpoints
- –°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é `financeDomain`
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫

---

## üìä –ò—Ç–æ–≥–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

**–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (2-13) –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ
- ‚úÖ Race conditions –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚úÖ –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Rate limiting
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–í—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞** (P1-P4): –º–µ–º–æ–∏–∑–∞—Ü–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ **UX —É–ª—É—á—à–µ–Ω–∏—è** (U1-U4): –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
- ‚úÖ **–ë—ç–∫–µ–Ω–¥ –∏ –ë–î** (B1-B4): –∏–Ω–¥–µ–∫—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** (R1-R2): –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π, –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** (A1-A3): –µ–¥–∏–Ω—ã–π –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤, —á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞

### üìà –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞, –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- **UX**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å, –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, —É–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ï–¥–∏–Ω—ã–π –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤, —á–∏—Å—Ç—ã–π –∫–æ–¥

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `COMPARISON_STAFF_FINANCE_PAGES.md` - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- `PROBLEMS_STAFF_FINANCE.md` - –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–±–ª–µ–º (—Å—Ç–∞—Ä—ã–π –¥–æ–∫—É–º–µ–Ω—Ç)
