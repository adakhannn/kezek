# Задачи по улучшению Kezek

Документ с приоритизированным списком задач по результатам анализа проекта.  
Обновляйте статус по мере выполнения.

**Легенда статусов:** `[ ]` — не начато | `[~]` — в работе | `[x]` — сделано

**Последний анализ:** 2026-02 (повторный обход кодовой базы, PROJECT_REVIEW.md, DEEP_ANALYSIS_ISSUES.md, FEATURE_MATRIX.md, EVOLUTION_TECH_PLAN.md).

---

## Быстрые победы

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Обновить `apps/web/README.md` | Добавить: команду `pnpm -C apps/web dev`, ссылки на CONTRIBUTING.md и PROJECT_DOCUMENTATION.md, перечень основных env-переменных. |
| [x] | Добавить `GETTING_STARTED.md` в корень | Единый документ для новых разработчиков: установка, env для web и mobile, первые команды (dev, test, lint), ссылки на PROJECT_DOCUMENTATION и TESTING_GUIDE. |
| [x] | Добавить `.env.example` в `apps/web` | Шаблон с пустыми/заглушками значениями и комментариями (без секретов). В README/GETTING_STARTED указать копирование в `.env.local`. |
| [x] | Добавить `.env.example` в `apps/mobile` | Аналогично web: шаблон с комментариями, ссылка в документации. |
| [x] | Обновить Husky pre-commit под v10 | Удалить из `.husky/pre-commit` строки `#!/usr/bin/env sh` и `. "$(dirname -- "$0")/_/husky.sh"` (deprecated в husky v10). Оставить только вызовы lint-staged и typecheck. |

---

## UX

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | QuickDesk: пресеты по филиалу | При большом объёме данных — пресеты фильтра по филиалу; при необходимости пагинация/виртуализация списка бронирований. |
| [x] | Онбординг в кабинете сотрудника (staff) | Краткие подсказки при первом входе: что такое «смены», «финансы», «слоты», чтобы снизить когнитивную нагрузку. |
| [x] | Публичное бронирование: индикаторы шага | Явные индикаторы «Шаг 2 из 5»; при необходимости сохранение прогресса в URL (query), чтобы не терять выбор при обновлении страницы. |
| [x] | Статус интеграций в дашборде | Показывать статус WhatsApp/Telegram; при сбоях — понятные сообщения и retry/backoff. |
| [x] | Публичное бронирование: прогресс в URL | Опционально сохранять шаг и выбранные опции (филиал, услуга, дата) в query-параметрах, чтобы при обновлении страницы не терять прогресс. |

---

## Developer Experience

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Чеклист перед PR в CONTRIBUTING | Явно прописать: lint, typecheck, test (и при необходимости test:coverage), e2e при изменении критичных флоу; для mobile — smoke и сборка. |
| [x] | Единый гайд по env | Объединить ENV_SETUP, ENV_FIX, части WHATSAPP_SETUP в один основной файл с ссылками на специфичные (WhatsApp, Telegram). |
| [x] | Регулярная проверка актуальности цифр | В PROJECT_REVIEW и DEEP_ANALYSIS_ISSUES (покрытие, кол-во route-файлов, миграций) — обновлять раз в квартал. |

---

## Код и надёжность

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Повысить порог покрытия Jest | Постепенно с 40% до 45–50%; в первую очередь тесты для новых и изменяемых API и financeDomain. |
| [x] | Расширить E2E-сценарии | Полный цикл бронирования с гостем; смена статусов в QuickDesk; один сценарий «финансы сотрудника» (открытие смены → клиенты → закрытие). |
| [x] | WhatsApp: автоответы на команды | Доработать отмену/подтверждение брони по командам; расширить тесты привязки к клиентам и бронированиям. |
| [x] | Мониторинг ошибок | Формально включить и описать в документации провайдер (Sentry/LogRocket) поверх существующей обёртки errorMonitoring.ts. |
| [x] | Поднять порог покрытия Jest до 50%+ | По мере роста тестов увеличить coverageThreshold в apps/web/jest.config.js (branches, functions, lines, statements). |
| [x] | E2E для новых критичных флоу | При добавлении важных пользовательских сценариев — добавлять соответствующие E2E в apps/web/e2e (например, промо, споры по финансам уже есть). |

---

## Эволюционные улучшения

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | WhatsApp: расширение сценариев | На базе webhook и команд (отмена, подтвердить, помощь) добавить сценарии: выбор из нескольких броней, напоминания, интеграция с уведомлениями/CRM при необходимости. |
| [x] | Rate limiting: точечная настройка | При необходимости настроить per-user или per-route лимиты поверх текущих RateLimitConfigs (см. rateLimit.ts). |
| [x] | Sentry: source maps в CI | В CI задать SENTRY_AUTH_TOKEN (и при необходимости SENTRY_ORG, SENTRY_PROJECT) для загрузки source maps при сборке; см. PROJECT_DOCUMENTATION.md, раздел «Мониторинг ошибок». |

---

## Mobile

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Smoke-тесты для новых экранов | При добавлении новых экранов в apps/mobile — добавлять соответствующие smoke-тесты (по аналогии с WhatsAppScreen, SignIn и т.д.). |
| [x] | Регрессия на устройствах перед релизом | Перед крупным релизом проверять ключевые сценарии на реальных устройствах (iOS/Android). |

---

## Финансы и рейтинги

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Документировать новые типы выплат | При добавлении новых типов выплат или формул — зафиксировать в SYSTEM_FEATURES_DOCUMENTATION и в коде (financeDomain). |
| [x] | Алерты при сбое cron рейтингов | Настроить оповещение (health-check или мониторинг) при падении или значительной задержке cron пересчёта рейтингов. |

---

## Качество и доступность

| Статус | Задача | Детали |
|--------|--------|--------|
| [x] | Аудит доступности (a11y) | Выборочная проверка ключевых страниц (бронирование, дашборд, кабинет) на соответствие a11y (роли, aria, контраст, фокус). |
| [x] | JSDoc для важных модулей | Дополнить JSDoc для публичных функций в часто изменяемых модулях (например, домен бронирований, API-хелперы). |

---

## Как пользоваться

- Отмечайте выполнение: замените `[ ]` на `[x]`.
- Для «в работе» используйте `[~]`.
- Новые задачи добавляйте в соответствующий блок с тем же форматом таблицы.
- Ссылка на анализ: см. PROJECT_DOCUMENTATION.md, FEATURE_MATRIX.md, PROJECT_REVIEW.md, DEEP_ANALYSIS_ISSUES.md, EVOLUTION_TECH_PLAN.md.
- **Раз в квартал:** обновлять цифры в PROJECT_REVIEW.md и DEEP_ANALYSIS_ISSUES.md (покрытие, кол-во route-файлов, миграций); в обоих документах есть блок «Проверка актуальности».
