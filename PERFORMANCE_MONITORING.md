# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π, —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤ (`get_free_slots_service_day_v2`)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** RPC —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
  - ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: > 2 —Å–µ–∫—É–Ω–¥
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 5 —Å–µ–∫—É–Ω–¥
- **–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** `apps/web/src/app/b/[slug]/hooks/useSlotsLoader.ts`

### 2. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã (`shift_close`)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å —Ä–∞—Å—á–µ—Ç–æ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤
- **–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
  - ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: > 3 —Å–µ–∫—É–Ω–¥
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 10 —Å–µ–∫—É–Ω–¥
- **–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** `apps/web/src/app/api/staff/shift/close/route.ts`

### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ (`apply_promotion`)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ü–∏–π –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –ø–æ—Å–µ—â–µ–Ω–∏—è
- **–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
  - ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: > 1 —Å–µ–∫—É–Ω–¥—ã
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 3 —Å–µ–∫—É–Ω–¥
- **–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** `apps/web/src/app/api/bookings/[id]/mark-attendance/route.ts`

### 4. –ü–µ—Ä–µ—Å—á—ë—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (`recalculate_ratings`)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —Ñ–∏–ª–∏–∞–ª–æ–≤ –∏ –±–∏–∑–Ω–µ—Å–æ–≤
- **–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
  - ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: > 30 —Å–µ–∫—É–Ω–¥
  - üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: > 60 —Å–µ–∫—É–Ω–¥
- **–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** `apps/web/src/app/api/cron/recalculate-ratings/route.ts`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –∫–æ–¥–µ

```typescript
import { measurePerformance } from '@/lib/performance';

// –û–±–µ—Ä–Ω—É—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
const result = await measurePerformance(
    'operation_name',
    async () => {
        // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
        return await someAsyncOperation();
    },
    { metadata: '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' }
);
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫

1. **–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:** `/admin/performance`
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
   - –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ (–∑–µ–ª–µ–Ω—ã–π/–∂–µ–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π)

2. **–ß–µ—Ä–µ–∑ API:** `GET /api/admin/performance/stats`
   - –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–î–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **avgDuration** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **minDuration** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- **maxDuration** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- **p95Duration** - 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å
- **p99Duration** - 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å
- **errorRate** - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫

## –ê–ª–µ—Ä—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:

- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (WARN):** –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `logWarn` –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **–ö—Ä–∏—Ç–∏—á–Ω–æ (ERROR):** –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `logError` –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Ä–æ–≥–∞

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (email, Slack, Telegram).

## –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç—Ä–∏–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–µ—Ç—Ä–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (in-memory). –≠—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è dev/staging –æ–∫—Ä—É–∂–µ–Ω–∏–π.

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º—É–º 1000 –º–µ—Ç—Ä–∏–∫ –≤ –ø–∞–º—è—Ç–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Datadog, New Relic, CloudWatch)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `apps/web/src/lib/performance.ts`:

```typescript
const PERFORMANCE_THRESHOLDS: Record<string, { warn: number; error: number }> = {
    'operation_name': { warn: 2000, error: 5000 }, // –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
};
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫ –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:

1. –û–±–µ—Ä–Ω—É—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –≤ `measurePerformance`:
```typescript
const result = await measurePerformance('new_operation', async () => {
    return await yourOperation();
}, { metadata });
```

2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `PERFORMANCE_THRESHOLDS` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

