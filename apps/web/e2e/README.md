# E2E Тесты для критичных пользовательских сценариев

## Обзор

E2E тесты используют Playwright для тестирования полных пользовательских сценариев в браузере.

## Установка

```bash
cd apps/web
pnpm install
```

## Настройка

Создайте файл `.env.local` в `apps/web/` с тестовыми данными:

```env
PLAYWRIGHT_TEST_BASE_URL=http://localhost:3000
E2E_TEST_BUSINESS_SLUG=test-business-slug
E2E_TEST_STAFF_EMAIL=staff@test.com
E2E_TEST_STAFF_PASSWORD=test-password
```

## Запуск тестов

```bash
# Запустить все E2E тесты
pnpm test:e2e

# Запустить с UI (интерактивный режим)
pnpm test:e2e:ui

# Запустить в видимом браузере
pnpm test:e2e:headed

# Запустить конкретный тест
pnpm test:e2e e2e/booking-flow.spec.ts
```

## Тестовые сценарии

### 1. Полный цикл бронирования (`booking-flow.spec.ts`)

Тестирует полный процесс бронирования:
- Выбор филиала
- Выбор мастера
- Выбор услуги
- Выбор даты и времени
- Заполнение данных клиента
- Подтверждение бронирования

### 2. Управление сменой (`shift-management.spec.ts`)

Тестирует процесс работы сотрудника со сменой:
- Открытие смены
- Добавление клиентов в смену
- Закрытие смены с расчетом финансов

### 3. Применение промо (`promotion-application.spec.ts`)

Тестирует применение промоакций:
- Отображение промоакций на странице
- Применение промо при бронировании
- Проверка скидки в итоговой сумме

## Настройка тестовой базы данных

Для корректной работы E2E тестов рекомендуется:

1. Создать отдельную тестовую базу данных
2. Настроить seed данные (тестовый бизнес, филиалы, услуги, промоакции)
3. Очищать данные перед/после каждого теста

## Селекторы

Тесты используют `data-testid` атрибуты для поиска элементов. Убедитесь, что в UI компонентах добавлены соответствующие атрибуты:

```tsx
<button data-testid="branch-select">Выбрать филиал</button>
<div data-testid="master-card">...</div>
```

## Отладка

- Используйте `await page.pause()` для остановки выполнения
- Запускайте тесты в headed режиме: `pnpm test:e2e:headed`
- Просматривайте скриншоты и видео в `test-results/`
- Используйте Playwright Inspector: `pnpm test:e2e:ui`

## CI/CD

E2E тесты автоматически запускаются в CI pipeline. Убедитесь, что:
- Тестовая база данных доступна
- Переменные окружения настроены
- Тестовые данные подготовлены

