## Новый план проблемных зон Kezek

Этот список — только **актуальные проблемы и долги**, без уже решённых задач.

### 1. Стабильность денег и смен

1. **Граничные кейсы смен и гарантий**
   - Проверить и при необходимости доработать:
     - смены, которые длятся больше суток или открыты “слишком долго”;
     - ручные правки `hours_worked` в комбинации с гарантией;
     - изменения расписания/ставок задним числом, когда смена уже закрыта.
   - Зафиксировать ожидаемое поведение в документации, чтобы владелец и разработчик одинаково понимали “как должно работать”.

2. **Отчётность для владельца по периодам (не только по сменам)**
   - Нужен простой агрегированный отчёт по периоду (день / неделя / месяц) по бизнесу и по филиалу:
     - суммарный оборот, доля мастеров, доля салона, расходники, гарантии/доплаты.
   - Цель: владелец может ответить “сколько мы заработали за неделю/месяц” без выгрузок в Excel.

---

### 2. Бронирование и UX

3. **Сложность и хрупкость `BookingForm`**
   - Текущий компонент бронирования (страница `/b/[slug]/booking`) остаётся тяжёлым и чувствительным к любым изменениям:
     - много завязок на временные переводы, фильтрацию услуг, разные статусы броней;
     - сложная стейт‑машина шагов и большое количество `useEffect`.
   - Задача: постепенно довести структуру до более простой и предсказуемой (разделение шагов, локальные хелперы, явные события вместо “магии”).

4. **Прозрачность ошибок и “пустых состояний” в бронировании**
   - До конца унифицировать поведение во всех ситуациях, когда клиент не видит слоты или не может записаться:
     - нет расписания, мастер не делает услугу, техническая ошибка, конфликт расписания и т.п.
   - Важно: на трёх языках всегда показывать понятное объяснение, а не просто пустой экран без слотов.

---

### 3. Акции и лояльность

5. **Сложные сценарии промо и их отладка**
   - Несмотря на формализованный приоритет и базовые тесты, остаются рискованные места:
     - комбинации нескольких типов промо у одного клиента за короткий период;
     - ручные правки статусов брони (через админку, cron, смены) и их влияние на историю использования акций;
     - корректность данных в `client_promotion_usage` и `client_referrals` при редких/ошибочных сценариях.
   - Нужен более удобный инструмент для отладки конкретного клиента/филиала (мини‑“история акций” по клиенту).

6. **Маркетинговый фронт для акций**
   - Сейчас акции технически работают, но не до конца “продают себя”:
     - нет отдельного раздела/лендинга с понятным описанием всех активных акций бизнеса;
     - нет простого способа для владельца проверить, как именно акция отображается клиенту и как часто используется.

---

### 4. Рейтинги и доверие к ним

7. **Объяснимость рейтингов для владельца и сотрудников**
   - Уже есть коэффициенты и веса, но остаются вопросы “почему у меня такой балл?”.
   - Нужны простые пояснения на дашборде:
     - для бизнеса/филиала/сотрудника — краткий разбор: отзывы / количество клиентов / возвращаемость / дисциплина;
     - понятный ответ, что нужно улучшить, чтобы рейтинг вырос (на уровне текстовых подсказок).

8. **Долгосрочное здоровье рейтингов (данные за старые периоды)**
   - Проверить и зафиксировать стратегию:
     - что делать с рейтингами при долгих паузах в работе бизнеса/филиала/мастера;
     - как обрабатывать периоды без метрик (каникулы, простой);
     - как вести себя при больших изменениях конфигурации весов (миграция “старых” рейтингов).

---

### 5. Тесты, диагностика и эксплуатация

9. **Ещё более автоматизировать проверки критичных сценариев**
   - Текущий SQL‑набор покрывает базовые кейсы, но:
     - не проверяет сложные комбинации смен + промо + рейтингов за несколько дней;
     - не гоняется автоматически в CI перед деплоем.
   - Задача: выделить несколько “эталонных” сценариев (микро‑интеграционные тесты) и сделать их частью регулярного пайплайна.

10. **Наблюдаемость и алерты для продакшена**
    - На основе уже добавленных логов и health‑панелей:
      - определить минимальный набор сигналов для тревоги (не закрылись смены, не пересчитались рейтинги, промо перестали применяться);
      - завести простой канал оповещений (например, лог‑алерт в Telegram/почту) без тяжёлой инфраструктуры.

