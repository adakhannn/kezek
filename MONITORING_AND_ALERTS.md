# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã –¥–ª—è Kezek

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º.

## –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è

### 1. –°–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å–º–µ–Ω—ã —Å—Ç–∞—Ä—à–µ 2 –¥–Ω–µ–π
- **–ü–æ—Ä–æ–≥**: 2 –¥–Ω—è
- **–¢–∏–ø –∞–ª–µ—Ä—Ç–∞**: –û—à–∏–±–∫–∞ (error)

### 2. –†–µ–π—Ç–∏–Ω–≥–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–æ—Å–ª–µ–¥–Ω—è—è –¥–∞—Ç–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫
- **–ü–æ—Ä–æ–≥**: –ë–æ–ª–µ–µ 2 –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
- **–¢–∏–ø –∞–ª–µ—Ä—Ç–∞**: –û—à–∏–±–∫–∞ (–µ—Å–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å) –∏–ª–∏ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–µ—Å–ª–∏ > 2 –¥–Ω–µ–π)

### 3. –ü—Ä–æ–º–æ (–∞–∫—Ü–∏–∏)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ
- **–ü–æ—Ä–æ–≥**: –ë–æ–ª–µ–µ 7 –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ)
- **–¢–∏–ø –∞–ª–µ—Ä—Ç–∞**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (warning)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Vercel (–ø—Ä–æ–¥–∞–∫—à–µ–Ω):

```env
# Email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
ALERT_EMAIL_TO=admin@example.com

# Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è EMAIL_FROM)
EMAIL_FROM="Kezek <noreply@mail.kezek.kg>"

# API –∫–ª—é—á Resend –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
RESEND_API_KEY=re_...

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è cron jobs (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
CRON_SECRET=your-secret-key-here
# –∏–ª–∏
VERCEL_CRON_SECRET=your-secret-key-here
```

### Vercel Cron Jobs

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ `apps/web/vercel.json`:

```json
{
  "crons": [
    {
      "path": "/api/cron/health-check-alerts",
      "schedule": "0 9 * * *"
    }
  ]
}
```

Cron job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ **09:00 UTC** (14:00 Bishkek).

**–í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cron job –ø–æ—è–≤–∏–ª—Å—è –≤ Vercel Dashboard ‚Üí Settings ‚Üí Cron Jobs.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä Health Check –≤—Ä—É—á–Ω—É—é

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/admin/health-check`
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

### API Endpoint

–î–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

```bash
GET /api/admin/health-check
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞

**–û—Ç–≤–µ—Ç**:
```json
{
  "ok": true,
  "alerts": [],
  "checks": {
    "shifts": {
      "ok": true,
      "openShiftsOlderThan2Days": 0,
      "lastCheckDate": "2026-01-24"
    },
    "ratings": {
      "ok": true,
      "staffLastMetricDate": "2026-01-23",
      "branchLastMetricDate": "2026-01-23",
      "bizLastMetricDate": "2026-01-23",
      "daysSinceLastMetric": 1
    },
    "promotions": {
      "ok": true,
      "lastAppliedDate": "2026-01-22T10:00:00Z",
      "daysSinceLastApplication": 2,
      "activePromotionsCount": 5
    }
  }
}
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å cron endpoint –Ω–∞–ø—Ä—è–º—É—é:

```bash
curl -X GET "https://kezek.kg/api/cron/health-check-alerts" \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

## –§–æ—Ä–º–∞—Ç email-–∞–ª–µ—Ä—Ç–æ–≤

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è HTML-email —Å:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–ª–µ—Ä—Ç–æ–≤ (–æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
- –î–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã
- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä —Ç–µ–º—ã –ø–∏—Å—å–º–∞**: `üö® Kezek Alert: 2 –æ—à–∏–±–æ–∫, 1 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π`

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logDebug` –∏ `logError` –∏–∑ `@/lib/log`:
- –£—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: —Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ
- –û—à–∏–±–∫–∏: –≤—Å–µ–≥–¥–∞ (dev –∏ prod)

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ `apps/web/src/app/api/admin/health-check/route.ts`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –±–ª–æ–∫ `try`
3. –î–æ–±–∞–≤—å—Ç–µ –∞–ª–µ—Ä—Ç –≤ –º–∞—Å—Å–∏–≤ `alerts` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã
4. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø `HealthCheckResult` –¥–ª—è –Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
5. –û–±–Ω–æ–≤–∏—Ç–µ UI –≤ `apps/web/src/app/admin/health-check/page.tsx`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤ `apps/web/src/lib/alerts.ts` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `sendAlertTelegram`)
2. –í—ã–∑–æ–≤–∏—Ç–µ –µ—ë –≤ `apps/web/src/app/api/cron/health-check-alerts/route.ts` –ø–æ—Å–ª–µ `sendAlertEmail`

## Troubleshooting

### –ê–ª–µ—Ä—Ç—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `ALERT_EMAIL_TO` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `RESEND_API_KEY` –≤–∞–ª–∏–¥–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel –¥–ª—è `/api/cron/health-check-alerts`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ cron job –∞–∫—Ç–∏–≤–µ–Ω –≤ Vercel Dashboard

### Health Check –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä–æ–≥–∏ –≤ –∫–æ–¥–µ (2 –¥–Ω—è –¥–ª—è —Å–º–µ–Ω/—Ä–µ–π—Ç–∏–Ω–≥–æ–≤, 7 –¥–Ω–µ–π –¥–ª—è –ø—Ä–æ–º–æ)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ cron jobs –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω –∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é

### Cron job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `vercel.json` –≤ `apps/web/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –¥–µ–ø–ª–æ–∏—Ç—Å—è –∏–∑ `apps/web/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard ‚Üí Functions ‚Üí Cron Jobs

