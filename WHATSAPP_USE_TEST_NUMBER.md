# Использование тестового номера WhatsApp

## Найденные данные

✅ **Phone Number ID (тестовый):** `943058622222058`  
✅ **Номер телефона (тестовый):** `15551533441`  
✅ **Platform Type:** `CLOUD_API`  
✅ **Quality Rating:** `GREEN`  
⚠️ **Code Verification Status:** `NOT_VERIFIED` (нормально для тестового номера)

## Преимущества тестового номера

1. ✅ **Работает сразу** - не нужно ждать верификации
2. ✅ **Не требует регистрации** - готов к использованию
3. ✅ **Можно отправлять сообщения** вне 24-часового окна (если получатель добавлен в список тестовых)
4. ✅ **Идеален для разработки** - можно тестировать без ограничений

## Шаг 1: Обновление переменных окружения

### В продакшене (Vercel):

1. Перейди в настройки проекта Vercel
2. Environment Variables
3. Обнови `WHATSAPP_PHONE_NUMBER_ID`:

```env
WHATSAPP_ACCESS_TOKEN=твой_long_lived_token
WHATSAPP_PHONE_NUMBER_ID=943058622222058  # ← Тестовый номер
WHATSAPP_VERIFY_TOKEN=kezek_whatsapp_verify
```

4. Сохрани и перезапусти деплой

### Локально (`.env.local`):

```env
WHATSAPP_ACCESS_TOKEN=твой_long_lived_token
WHATSAPP_PHONE_NUMBER_ID=943058622222058  # ← Тестовый номер
WHATSAPP_VERIFY_TOKEN=kezek_whatsapp_verify
```

## Шаг 2: Добавление тестовых получателей

Для отправки сообщений на тестовый номер, получатели должны быть добавлены в список тестовых:

1. Перейди в [Meta Developers](https://developers.facebook.com/apps/)
2. Выбери приложение
3. Перейди в **WhatsApp** → **Быстрый старт** → **Протестируйте API**
4. Найди раздел **"Управление номерами"** или **"Manage phone number list"**
5. Добавь номера получателей (например, `+996500574029`)
6. Сохрани

**Важно:** Без добавления получателей в список тестовых, сообщения могут не доставляться или выдавать ошибку "Re-engagement message".

## Шаг 3: Проверка конфигурации

После обновления переменных, проверь:

```
GET https://kezek.kg/api/whatsapp/diagnose
```

Endpoint должен показать:
- ✅ Phone Number ID найден
- ✅ Номер доступен
- ✅ Статус: готов к использованию

## Шаг 4: Тестирование

### Тест 1: Отправка OTP через WhatsApp

1. Зайди в профиль пользователя
2. Добавь номер телефона (например, `+996500574029`)
3. Нажми **"Отправить код"** для верификации WhatsApp
4. Код должен прийти на WhatsApp

**Важно:** Убедись, что номер получателя (`+996500574029`) добавлен в список тестовых получателей!

### Тест 2: Уведомления о бронированиях

1. Создай тестовое бронирование
2. Проверь, что уведомление пришло на WhatsApp (если включено в настройках профиля)

## Переключение между тестовым и продакшн номером

### Для разработки (тестовый номер):
```env
WHATSAPP_PHONE_NUMBER_ID=943058622222058  # Тестовый
```

### Для продакшена (основной номер):
```env
WHATSAPP_PHONE_NUMBER_ID=862538650287008  # Основной (после верификации)
```

## Важные моменты

1. **Тестовый номер:**
   - ✅ Работает сразу
   - ✅ Не требует верификации
   - ⚠️ Получатели должны быть в списке тестовых
   - ⚠️ Не подходит для продакшена (видно "Test Number")

2. **Основной номер (`+996 224 701 717`):**
   - ⚠️ Требует верификации
   - ⚠️ Может быть "На рассмотрении"
   - ✅ Подходит для продакшена
   - ✅ Не требует добавления получателей в список тестовых (после верификации)

## Рекомендация

**Для разработки и тестирования:**
- Используй тестовый номер (`943058622222058`)
- Добавь получателей в список тестовых

**Для продакшена:**
- Дождись верификации основного номера (`862538650287008`)
- Затем переключись на основной номер

---

**Готово!** Теперь можно использовать тестовый номер для разработки и тестирования WhatsApp API.

