# План эволюционных улучшений Kezek (i18n, UX, дашборд)

**Цель документа**: зафиксировать список улучшений, которые можно постепенно реализовывать — без «революций», но с заметным ростом качества для операторов, менеджеров и клиентов на трёх языках (KY / RU / EN).

Документ разбит по направлениям. Каждый пункт можно брать как отдельную маленькую задачу.

---

## 1. Языки и i18n (KY / RU / EN) — довести до «полной» локализации

### 1.1. Аудит и вынос всех строк в словари

- **Задача 1.1.1** ✅ **(Выполнено)**: пройтись по `apps/web/src` и найти все захардкоженные русские строки в JSX/TSX:
  - особенно страницы:
    - `app/dashboard/**` (staff, services, finance, schedule, promotions),
    - `app/staff/**`,
    - общие компоненты (`components/**`, `app/_components/**`).
- **Задача 1.1.2** ✅ **(Выполнено)**: для каждой найденной строки:
  - завести ключ в i18n-словаре (см. п. 6),
  - заменить строку на `t('key', 'Русская фраза по умолчанию')`.
  - **Состояние**: все найденные русские UI‑строки в `apps/web/src` либо обёрнуты в `t(...)`, либо переведены на локализованные структуры (оставшаяся кириллица — только в комментариях и уже существующих ключах).

### 1.2. Выравнивание трёх языков по ключам

- **Задача 1.2.1** ✅ **(Выполнено)**: для всех ключей, которые уже есть в `ky`:
  - добавить явные переводы **в `ru` и `en`**, без надежды на fallback/транслитерацию.
  - **Итог**: для критичных доменов (`auth`, `booking`, `dashboard`, `staff`, `services`, `finance`) словари KY/RU/EN приведены к единому набору ключей; все новые ключи (`notifications.whatsapp.*`, `dashboard.bookings.*`, `datePicker.*`, `monthPicker.*`, `admin.userBasic.*`, `admin.userRoles.*` и др.) имеют переводы на трёх языках.
- **Задача 1.2.2** ✅ **(Выполнено)**: пройтись по критичным бизнесовым доменам:
  - `booking` (публичный поток),
  - `dashboard` (общий обзор),
  - `staff` (список, карточка, формы),
  - `services` (список, формы),
  - `finance` (страницы по доходам/сменам),
  - убедиться, что **все статусы, кнопки, подписи колонок, ошибки и empty‑states** есть на трех языках.
  - **Итог**: публичный поток бронирования, дашборд и основные операторские/финансовые экраны staff/dashboard проверены; пользовательские статусы, основные действия, заголовки, подписи колонок и ключевые сообщения об ошибках имеют локализации KY/RU/EN.

### 1.3. Единая логика названий услуг/мастеров

- **Задача 1.3.1** ✅ **(Выполнено)**: привести к единому подходу функции вида:
  - `getServiceName(...)`,
  - `formatStaffName(...)`,
  - и аналогичные, которые зависят от `locale`.
  - **Итог**: во всех ключевых местах (`booking` публичный, дашборд, staff‑кабинет, формы создания/редактирования брони) используется единый паттерн:
    - для KY: брать `name_ky`, если заполнено, иначе fallback на `name_ru`,
    - для RU: использовать `name_ru`,
    - для EN: использовать `name_en`, если есть, иначе транслитерировать `name_ru`; имена мастеров для EN также транслитерируются.
- **Задача 1.3.2** ✅ **(Выполнено)**: правила выбора названия:
  - если для выбранного языка есть поле (`name_ky` / `name_en`) — использовать его,
  - если нет — fallback на `name_ru`,
  - для английского при отсутствии перевода — использовать транслитерацию.

---

## 2. UX для операторов и менеджеров (QuickDesk / дашборд)

### 2.1. Ошибки и уведомления

- **Задача 2.1.1**: ✅ **Выполнено** — найдены все места, где в операторских экранах используются `alert(...)` и простые незалокализованные тексты ошибок.
  - Проведен аудит всех операторских экранов: `dashboard/bookings/view.tsx`, `dashboard/services/DeleteServiceButton.tsx`, `dashboard/branches/*`, `dashboard/staff/*`, `staff/*`, а также общих компонентов (`TimeRangeList`, `SlotButton`).
- **Задача 2.1.2**: ✅ **Выполнено** — заменены все `alert(...)` на локализованные toast-уведомления через `useToast()` с понятными текстами на трёх языках (KY/RU/EN).
  - **Покрытые модули:**
    - `dashboard/bookings/view.tsx` — все операции с бронями (подтверждение, отмена, отметка посещения, создание через QuickDesk)
    - `dashboard/services/DeleteServiceButton.tsx` — ошибки удаления услуги
    - `dashboard/branches/DeleteBranchButton.tsx` — ошибки удаления филиала
    - `dashboard/branches/[id]/BranchPromotionsPanel.tsx` — все операции с акциями (загрузка, создание, обновление, удаление)
    - `dashboard/staff/[id]/finance/components/StaffFinanceStats.tsx` — ошибки редактирования часов смены
    - `dashboard/staff/[id]/schedule/Client.tsx` — ошибки сохранения/применения расписания
    - `components/pickers/TimeRangeList.tsx` — валидация временных интервалов
    - `components/SlotButton.tsx` — ошибки создания быстрой брони
    - `dashboard/branches/BranchesListClient.tsx` — ошибки генерации QR-кода
  - **Добавлены i18n ключи:** `timeRange.startBeforeEnd`, `timeRange.empty`, `staff.schedule.applyBranchError`, `branches.qr.businessInfoError` для всех трёх языков.
  - **ToastContainer добавлен** во все компоненты, использующие `useToast()`.

### 2.2. QuickDesk как полноценное рабочее место

- **Задача 2.2.1**: ✅ **Выполнено** — добавлена панель статуса в QuickDesk с информацией на сегодня/завтра.
  - **Реализовано:**
    - Панель статуса отображает количество записей на сегодня и завтра (загружается из БД)
    - Показывает свободные слоты для выбранной даты (динамически обновляется при загрузке слотов)
    - Добавлены кнопки быстрых действий для перехода в календарь и список броней
    - Панель имеет градиентный дизайн и адаптивна для мобильных устройств
    - Все тексты локализованы на трёх языках (KY/RU/EN)
  - **Добавлены i18n ключи:** `bookings.desk.statusPanel.*` для всех трёх языков.
  - **Интеграция:** Панель статуса интегрирована в компонент `QuickDesk` в `apps/web/src/app/dashboard/bookings/view.tsx`.
- **Задача 2.2.2**: ✅ **Выполнено** — добавлено визуальное разделение сценариев выбора клиента в QuickDesk.
  - **Реализовано:**
    - **Цветовое кодирование:**
      - Зелёный цвет для режима "Существующий клиент" (клиент найден в базе) — `bg-green-100 dark:bg-green-900/40 border-green-400`
      - Синий цвет для режима "Новый клиент" (звонок/лично) — `bg-blue-100 dark:bg-blue-900/40 border-blue-400`
      - Серый цвет для режима "Без клиента" (walk-in) — `bg-gray-100 dark:bg-gray-700`
    - **Визуальные индикаторы:**
      - Бейджи статуса в заголовке блока клиента (зелёный для "Клиент найден", синий для "Новый клиент")
      - Иконки для каждого режима (поиск для существующего, плюс для нового, пользователь для walk-in)
      - Подписи-подсказки под каждым режимом ("Поиск в базе", "Звонок/лично", "Walk-in")
      - Цветные границы и фоны для активных режимов
    - **Улучшенный UX:**
      - Карточки режимов с hover-эффектами
      - Информационные блоки с подсказками внутри форм поиска и ввода
      - Цветовая синхронизация всех элементов формы (инпуты, границы, иконки) с выбранным режимом
    - **Адаптивность:** Сетка из 3 колонок на десктопе, 1 колонка на мобильных устройствах
  - **Добавлены i18n ключи:** `bookings.desk.clientMode.*`, `bookings.desk.clientExisting.*`, `bookings.desk.clientNew.*`, `bookings.desk.clientNone.hint` для всех трёх языков (KY/RU/EN).
  - **Интеграция:** Визуальное разделение интегрировано в компонент `QuickDesk` в `apps/web/src/app/dashboard/bookings/view.tsx`.

### 2.3. Mobile‑first для операторов

- **Задача 2.3.1**: ✅ **Выполнено** — проверены и улучшены следующие экраны на мобильных ширинах:
  - **Список броней** (`dashboard/bookings` → `BookingsList`):
    - Улучшена мобильная карточная версия с более четкой структурой и иконками
    - Оптимизированы кнопки действий (`BookingActions`) — теперь они занимают всю ширину на мобильных (`flex-1`) для удобного тапа
    - Добавлены тени и активные состояния для лучшей обратной связи
    - Улучшена типографика и отступы для мобильных устройств
  - **Staff‑страницы** (`staff/bookings` → `StaffBookingsView`):
    - Адаптированы табы для мобильных — короткие версии текста на маленьких экранах
    - Улучшена карточная версия записей с адаптивной сеткой
    - Кнопки действий теперь занимают всю ширину на мобильных
    - Оптимизированы отступы и размеры шрифтов
  - **Страницы финансов сотрудников** (`staff/finance`):
    - Улучшены кнопки действий в `ClientItem` — увеличен размер тач-зоны (`p-2.5` на мобильных)
    - Добавлен `touch-manipulation` для лучшей производительности на мобильных
    - Оптимизированы иконки (больше на мобильных: `w-5 h-5`)
    - Улучшена мобильная версия отображения клиентов с четкой иерархией информации
  - **Список услуг/промо**:
    - `ServicesListClient` — уже имел хорошую мобильную карточную версию, проверена и подтверждена
    - `BranchPromotionsPanel` — улучшена мобильная версия:
      - Кнопки действий теперь в колонку на мобильных (`sm:flex-col`)
      - Кнопки занимают всю ширину на мобильных (`flex-1`)
      - Улучшена типографика заголовков с `truncate` для длинных названий
      - Оптимизированы отступы и размеры
- **Задача 2.3.2**: ✅ **Выполнено** — для каждого экрана:
  - ✅ Убран лишний горизонтальный скролл (использованы `min-w-0`, `truncate`, адаптивные сетки)
  - ✅ На мобильных оставлены только самые важные колонки/поля (desktop table скрыт через `hidden md:block`, mobile cards показывают ключевую информацию)
  - ✅ Основные действия доступны 1–2 тапами (кнопки увеличены, добавлены активные состояния, улучшены тач-зоны)
  - **Добавлены i18n ключи:** `staff.cabinet.bookings.tabs.upcomingShort`, `pastShort`, `createShort` для всех трёх языков (KY/RU/EN).

---

## 3. Время и таймзоны

### 3.1. Централизация работы с таймзоной

- **Задача 3.1.1**: ✅ **Выполнено** — убрано прямое использование `process.env.NEXT_PUBLIC_TZ` из рантайма фронта:
  - ✅ Добавлена функция `getTimezone()` в `apps/web/src/lib/time.ts` для единообразного доступа к таймзоне
  - ✅ Экспорт `TZ` сохранен для обратной совместимости (помечен как `@deprecated`, рекомендуется использовать `getTimezone()`)
  - ✅ Заменены все прямые использования `process.env.NEXT_PUBLIC_TZ` на импорт `TZ` из `@/lib/time` в следующих файлах:
    - `apps/web/src/app/staff/bookings/page.tsx`
    - `apps/web/src/app/dashboard/staff/[id]/StaffDetailPageClient.tsx`
    - `apps/web/src/app/booking/[id]/BookingLayoutClient.tsx`
    - `apps/web/src/app/cabinet/bookings/page.tsx`
    - `apps/web/src/app/staff/page.tsx`
  - ✅ Теперь все клиентские компоненты используют централизованный доступ к таймзоне через `@/lib/time`
- **Задача 3.1.2**: ✅ **Выполнено** — публичный поток и дашборд/календарь используют таймзону бизнеса:
  - ✅ Добавлена функция `getBusinessTimezone(businessTz?: string | null)` в `apps/web/src/lib/time.ts` для получения таймзоны бизнеса с fallback на дефолтную
  - ✅ Обновлены функции `todayTz()`, `dateAtTz()`, `toLabel()` для поддержки опционального параметра таймзоны
  - ✅ **Публичный поток** (`/b/[slug]/booking`):
    - Добавлено поле `tz` в запрос бизнеса в `apps/web/src/app/b/[slug]/page.tsx`
    - Добавлено поле `tz` в тип `Biz` в `apps/web/src/app/b/[slug]/types.ts`
    - Обновлен компонент `BookingForm` для использования таймзоны бизнеса через `getBusinessTimezone(biz.tz)`
    - Все форматирования дат и времени используют таймзону бизнеса вместо фиксированной `Asia/Bishkek`
  - ✅ **Дашборд/календарь** (`/dashboard/bookings`):
    - Добавлен запрос таймзоны бизнеса в `apps/web/src/app/dashboard/bookings/page.tsx`
    - Таймзона бизнеса передается в `BookingsClientWrapper` и далее в `AdminBookingsView`
    - Все компоненты (`CalendarDay`, `ListTable`, `QuickDesk`, `BookingPill`) используют таймзону бизнеса
    - Все форматирования дат и времени используют таймзону бизнеса вместо фиксированной `Asia/Bishkek`
  - ✅ Если таймзона бизнеса не указана (null или пустая), используется дефолтная таймзона из `process.env.NEXT_PUBLIC_TZ` или `'Asia/Bishkek'`

### 3.2. Подготовка к индивидуальному `tz` на бизнес

- **Задача 3.2.1**: ✅ **Выполнено** — предусмотрено использование таймзоны бизнеса (`business.tz`) во всех местах:
  - ✅ **Форматирование дат на фронте** — уже реализовано в задаче 3.1.2:
    - Публичный поток (`/b/[slug]/booking`) использует `getBusinessTimezone(biz.tz)` для всех форматирований
    - Дашборд/календарь (`/dashboard/bookings`) использует таймзону бизнеса для всех форматирований
  - ✅ **Расчёты статистики «за сегодня/за период» на дашборде**:
    - Обновлен `apps/web/src/app/dashboard/page.tsx`:
      - Добавлен запрос поля `tz` из таблицы `businesses`
      - Используется `getBusinessTimezone(biz?.tz)` для получения таймзоны бизнеса
      - Расчет диапазона "сегодня" использует `zonedTimeToUtc()` с таймзоной бизнеса вместо UTC
      - Статистика `bookingsToday` теперь корректно считается в таймзоне бизнеса
    - Обновлен `CalendarDay` в `apps/web/src/app/dashboard/bookings/view.tsx`:
      - Заменен жестко закодированный оффсет `+06:00` на использование таймзоны бизнеса
      - Используется `zonedTimeToUtc()` для корректного расчета начала и конца дня в таймзоне бизнеса
      - Добавлена зависимость `timezone` в `useEffect` для пересчета при изменении таймзоны
  - ✅ **Архитектура готова** для индивидуальной таймзоны на бизнес:
    - Функция `getBusinessTimezone()` обеспечивает fallback на дефолтную таймзону
    - Все компоненты получают таймзону бизнеса через пропсы или контекст
    - Форматирование и расчеты дат унифицированы через функции из `@/lib/time`

---

## 4. Тесты для ключевого UI (поверх уже сильных API‑тестов)

API и база уже хорошо покрыты, дальше — постепенно усиливать тесты UI.

### 4.1. E2E сценарии для операторских флоу

- **Задача 4.1.1**: ✅ **Выполнено** — добавить/расширить E2E‑сценарии для:
  - QuickDesk:
    - ✅ создать бронь,
    - ✅ изменить,
    - ✅ отменить,
    - ✅ отметить no‑show / «пришёл».
  - staff‑finance:
    - ✅ проверить корректность отображения часов/дохода по смене,
    - ✅ фильтрацию по датам.
  - promotions:
    - ✅ применить акцию к брони,
    - ✅ проверить итоговую сумму и статистику по промо.
  
  **Реализовано:**
  - Создан файл `apps/web/e2e/quickdesk.spec.ts` с полным набором тестов для QuickDesk (создание, изменение, отмена, отметка посещения/no-show).
  - Расширен файл `apps/web/e2e/staff-finance-pages.spec.ts` тестами для проверки отображения часов/дохода по смене и фильтрации по датам.
  - Расширен файл `apps/web/e2e/promotion-application.spec.ts` тестами для проверки применения промо к бронированию, итоговой суммы и статистики по промо.

### 4.2. Unit‑тесты для i18n‑хэлперов

- **Задача 4.2.1**: ✅ **Выполнено** — написать маленькие unit‑тесты для:
  - ✅ `getServiceName(...)`,
  - ✅ `formatStaffName(...)`,
  - ✅ выбора статусов/цветов статуса в списках броней.
- **Цель**: защититься от случайной поломки локализации и отображения статусов при рефакторинге.
  
  **Реализовано:**
  - Создан файл `apps/web/src/lib/i18nHelpers.ts` с централизованными утилитами:
    - `getServiceName()` — получение названия услуги с учетом языка (ru/ky/en) и транслитерации
    - `formatStaffName()` — форматирование имени сотрудника с транслитерацией для английского
    - `getStatusColor()` — получение конфигурации цветов для статусов бронирований (hold, confirmed, paid, cancelled, no_show)
  - Создан файл `apps/web/src/__tests__/lib/i18nHelpers.test.ts` с 23 unit-тестами:
    - 8 тестов для `getServiceName()` (все языки, fallback, транслитерация, edge cases)
    - 6 тестов для `formatStaffName()` (транслитерация, edge cases)
    - 9 тестов для `getStatusColor()` (все статусы, dark mode, border классы, неизвестные статусы)
  - Все тесты проходят успешно (23/23 passed)

---

## 5. i18n для системных страниц и ошибок

### 5.1. ErrorBoundary и fallback‑страницы

- **Задача 5.1.1**: ✅ **Выполнено** — пройтись по всем `ErrorBoundary` и fallback‑компонентам:
  - ✅ заменить «жёсткие» тексты на `t('key', 'Русский по умолчанию')`,
  - ✅ добавить ключи на трёх языках.
- **Задача 5.1.2**: ✅ **Выполнено** — локализовать:
  - ✅ `404` / кастомный `error`,
  - ✅ страницы «нет доступа», «нет бизнеса», и т.п.
  
  **Реализовано:**
  - Создана серверная функция `getT()` в `LanguageProvider.tsx` для использования в server components
  - Локализованы все ErrorBoundary и fallback компоненты:
    - `apps/web/src/components/ErrorDisplay.tsx` — уже использовал i18n ключи
    - `apps/web/src/app/_components/ErrorDisplay.tsx` — уже использовал i18n ключи
    - `apps/web/src/app/dashboard/bookings/BookingsClientWrapper.tsx` — локализован fallback
    - `apps/web/src/app/b/[slug]/booking/BookingFormClient.tsx` — локализован fallback
    - `apps/web/src/app/dashboard/staff/[id]/finance/StaffFinancePageClient.tsx` — локализован fallback
    - `apps/web/src/app/dashboard/staff/[id]/finance/stats/StaffFinanceStatsPageClient.tsx` — локализован fallback
  - Локализованы страницы ошибок:
    - `apps/web/src/app/admin/layout.tsx` — "Нет доступа (нужен супер-админ)"
    - `apps/web/src/app/admin/rating-config/page.tsx` — "Нет доступа. Только суперадмин может управлять настройками рейтинга."
    - `apps/web/src/app/admin/businesses/[id]/owner/page.tsx` — "Не авторизован", "Нет доступа", "Бизнес не найден", "Владельцы бизнеса"
    - `apps/web/src/app/dashboard/branches/new/page.tsx` — "Нет доступа" и "Только суперадмин может создавать филиалы."
    - `apps/web/src/app/dashboard/staff/[id]/slots/page.tsx` — "Сотрудник не найден или нет доступа" и "Ошибка загрузки услуг"
    - `apps/web/src/app/dashboard/bookings/page.tsx` — исправлен импорт для использования `getT()`
    - `apps/web/src/app/dashboard/staff/[id]/finance/not-found.tsx` — уже использовал i18n ключи
  - Добавлены i18n ключи на трех языках (KY/RU/EN):
    - `admin.noAccess.title`
    - `admin.ratingConfig.noAccess`
    - `admin.ratingConfig.error.load`
    - `admin.ratingConfig.error.loadConfig`
    - `admin.error.unauthorized`
    - `admin.error.load`
    - `admin.businesses.notFound`
    - `admin.businesses.owner.title`
    - `admin.businesses.owner.business`
    - `branches.new.noAccess.title`
    - `branches.new.noAccess.description`
    - `staff.slots.notFound`
    - `staff.slots.error.loadServices`

### 5.2. Системные / техстраницы

- **Задача 5.2.1**: ✅ **Выполнено** — привести к единому стилю и минимальной локализации:
  - ✅ страницы типа `/api-docs`,
  - ✅ диагностические / административные страницы,
  - ✅ всё, что может увидеть реальный пользователь (даже если редко).
  
  **Реализовано:**
  - Локализованы страницы API документации:
    - `apps/web/src/app/api-docs/page.tsx` — "Загрузка документации...", "Не удалось загрузить документацию"
  - Локализованы диагностические страницы:
    - `apps/web/src/app/admin/performance/page.tsx` — "Мониторинг производительности", "Загрузка..."
    - `apps/web/src/app/admin/health-check/page.tsx` — полностью локализована (заголовки, статусы, алерты, проверки смен/рейтингов/промо)
    - `apps/web/src/app/admin/ratings-status/page.tsx` — полностью локализована (заголовки, метрики, ошибки)
    - `apps/web/src/app/dev/super/page.tsx` — полностью локализована (заголовок, кнопка, сообщения)
  - Локализованы административные страницы:
    - `apps/web/src/app/admin/page.tsx` — главная страница админки (заголовки, метрики, таблицы, быстрые ссылки, системные проверки)
    - `apps/web/src/app/admin/_components/AdminNav.tsx` — навигация админки (все пункты меню)
    - `apps/web/src/app/admin/users/page.tsx` — список пользователей (заголовки, ошибки доступа)
    - `apps/web/src/app/admin/users/[id]/page.tsx` — страница деталей пользователя (заголовки, статусы, роли, блокировка, владелец бизнеса)
    - `apps/web/src/app/admin/categories/page.tsx` — список категорий (заголовки, статистика, таблица, статусы, пустые состояния)
    - `apps/web/src/app/admin/businesses/page.tsx` — список бизнесов (заголовки, статистика, статусы, пустые состояния, действия)
  - Добавлены i18n ключи на трех языках (KY/RU/EN):
    - `admin.nav.*` — навигация админки (12 ключей)
    - `admin.home.*` — главная страница админки (30+ ключей)
    - `admin.healthCheck.*` — health check страница (15+ ключей)
    - `admin.ratingsStatus.*` — страница статуса рейтингов (10+ ключей)
    - `admin.performance.title` — заголовок страницы производительности
    - `admin.users.*` — страницы пользователей (20+ ключей: заголовки, статусы, роли, блокировка)
    - `admin.categories.*` — страница категорий (20+ ключей: заголовки, статистика, таблица, статусы, пустые состояния)
    - `admin.businesses.*` — страница бизнесов (15+ ключей: заголовки, статистика, статусы, пустые состояния, действия)
    - `apiDocs.*` — страница API документации (2 ключа)
    - `dev.super.*` — страница для разработки (4 ключа)
    - `common.*` — общие ключи (7 ключей: loading, noData, ok, problem, warning, daysAgo, never)
  - Все страницы приведены к единому стилю с использованием темной темы (dark mode) и консистентной типографики

---

## 6. Архитектура словарей и типизация i18n

### 6.1. Разбиение словарей по доменам

- **Задача 6.1.1**: ✅ **Выполнено** — разнести текущий большой словарь на модули:
  - ✅ Создана структура папок `apps/web/src/app/_components/i18n/dictionaries/`
  - ✅ Создан паттерн модулей для всех доменов (по 3 файла на домен: `.ky.ts`, `.ru.ts`, `.en.ts`)
  - ✅ Создан `dictionaries/index.ts` для сборки всех модулей с функцией `mergeDictionaries()`
  - ✅ Создан `dictionaries/README.md` с документацией по структуре
  - ✅ Экспортирован тип `Translations` из `LanguageProvider.tsx`
  - ✅ Созданы модули для всех доменов:
    - `auth.*` (27 ключей на язык)
    - `booking.*` (101-105 ключей на язык)
    - `home.*` (10 ключей на язык)
    - `header.*` (14 ключей на язык)
    - `dashboard.*` (45-50 ключей на язык)
    - `staff.*` (325-338 ключей на язык)
    - `services.*` (40 ключей на язык)
    - `branches.*` (98-100 ключей на язык)
    - `finance.*` (38 ключей на язык)
    - `admin.*` (152 ключа на язык)
    - `common.*` (8 ключей на язык)
    - `datePicker.*`, `monthPicker.*`, `timeRange.*` (8, 4, 2 ключа соответственно)
    - `notifications.*` (17-19 ключей на язык)
    - `bookings.*` (95-96 ключей на язык)
    - `footer.*` (4 ключа на язык)
    - `cabinet.*` (97-99 ключей на язык, включает `cabinet.review.*`, `cabinet.map.*`, `cabinet.profile.*`)
    - `apiDocs.*` (2 ключа на язык)
    - `dev.*` (4 ключа на язык)
  - ✅ Всего создано 69 модульных файлов (23 домена × 3 языка)
  - ✅ Создан автоматизированный скрипт для извлечения ключей из оригинального файла (временные скрипты удалены после использования)
- **Задача 6.1.2**: ✅ **Выполнено** — собирать словари в один объект при инициализации `LanguageProvider`:
  - ✅ Создана функция `mergeDictionaries()` в `dictionaries/index.ts`
  - ✅ Все модули импортированы и собраны в `dictionaries/index.ts` для каждого языка (ky, ru, en)
  - ✅ Обновлен `LanguageProvider.tsx` для использования модулей из `dictionaries/index.ts`
  - ✅ Удалены встроенные словари из `LanguageProvider.tsx` (более 3600 строк кода удалено, файл сократился с 3711 до 116 строк)
  - ✅ `LanguageProvider.tsx` теперь использует импорт: `import { ky as kyModules, ru as ruModules, en as enModules } from './dictionaries'`
  - ✅ Все словари теперь организованы по доменам в отдельных файлах для лучшей поддержки и масштабируемости
  - ✅ Проверено: нет ошибок линтера, все модули корректно импортированы и собраны

### 6.2. Типизация ключей

- **Задача 6.2.1**: ✅ **Выполнено** — ввести типизированный список ключей:
  - ✅ Создан union‑тип `I18nKey` для всех i18n‑ключей на основе ключей из объединенного словаря русского языка (`keyof typeof ru`)
  - ✅ Обновлена сигнатура `t` вида `t<K extends I18nKey>(key: K, fallback?: string): string`
  - ✅ Обновлена сигнатура `getT` для использования `I18nKey`
  - ✅ Тип `I18nKey` экспортирован из `LanguageProvider.tsx` и `dictionaries/index.ts` для удобства использования
  - ✅ Обновлен тип `labelKey` в `AdminNav.tsx` с `string` на `I18nKey` для демонстрации работы типизации
- **Цель**: чтобы IDE/TypeScript ловили опечатки и несуществующие ключи на этапе разработки.
- **Результат**: Теперь TypeScript будет проверять, что все ключи, передаваемые в функцию `t()`, существуют в словарях. IDE будет предлагать автодополнение для ключей i18n.

---

## 7. Локаль на уровне `<html>` и SEO

### 7.1. Cookie‑based локаль

- **Задача 7.1.1**: ✅ **Выполнено** — хранить выбранный язык:
  - ✅ Создана утилита `apps/web/src/lib/cookies.ts` для работы с cookie (чтение/запись локали)
  - ✅ Язык хранится в cookie `kezek_lang` с максимальным сроком жизни 1 год
  - ✅ `LanguageProvider` обновлен для чтения локали из cookie при инициализации (приоритет: cookie → localStorage → браузерная локаль)
  - ✅ Функция `setLocale` обновлена для записи локали в cookie и синхронизации с localStorage (для обратной совместимости)
  - ✅ Создана server-side функция `getServerLocale()` для чтения локали из cookie в server components
  - ✅ Функция `getT()` обновлена для поддержки чтения локали из cookie (если локаль не передана явно)
  - ✅ Обратная совместимость: сохранена поддержка localStorage для плавной миграции
- **Задача 7.1.2**: ✅ **Выполнено** — выставлять `<html lang="ky|ru|en">` в зависимости от текущей локали:
  - ✅ `RootLayout` обновлен для чтения локали из cookie через `getServerLocale()` и установки `lang` в теге `<html>` на сервере
  - ✅ `LanguageProvider` обновлен для динамического обновления атрибута `lang` в `<html>` при изменении локали на клиенте (через `useEffect`)
  - ✅ Атрибут `lang` обновляется как на сервере (при первой загрузке), так и на клиенте (при изменении языка без перезагрузки страницы)
  - ✅ Если cookie отсутствует, используется локаль по умолчанию ('ru')

### 7.2. SEO для публичных страниц

- **Задача 7.2.1**: ✅ **Выполнено** — для публичных урлов (`/`, `/b/[slug]`, `/b/[slug]/booking`):
  - ✅ Создана утилита `generateAlternates()` в `apps/web/src/lib/seo.ts` для генерации hreflang-ссылок
  - ✅ Добавлены `generateMetadata` функции для всех трех публичных страниц с hreflang-ссылками
  - ✅ Добавлены локализованные SEO ключи в словари (`home.seo.*`, `business.seo.*`, `booking.seo.*`) для трех языков (KY/RU/EN)
  - ✅ `title` и `description` динамически генерируются на основе текущей локали из cookie
  - ✅ Для страниц бизнеса и бронирования используется имя бизнеса в title и description
  - ✅ Все hreflang-ссылки указывают на один и тот же URL (так как язык определяется через cookie, а не через URL)

---

## Как работать с этим документом

- Брать по одной маленькой задаче (под‑пункт) на спринт/день.
- После выполнения — отмечать в PR/коммитах ссылку на соответствующий пункт (например, `EVOLUTION_I18N_UX_PLAN.md: 1.1.2`).
- По мере появления новых идей по UX/i18n — дописывать новые задачи в соответствующие разделы (с датой и кратким описанием).


